require('dotenv').config();
const Database = require('better-sqlite3');

const DB_PATH = process.env.DB_PATH || './keys.db';
const db = new Database(DB_PATH);

db.exec(`
CREATE TABLE IF NOT EXISTS keys (
  key TEXT PRIMARY KEY,
  used INTEGER DEFAULT 0,
  device_id TEXT DEFAULT NULL,
  used_at TEXT DEFAULT NULL,
  revoked INTEGER DEFAULT 0
);
`);

const initialKeys = [
  'K1-KE4jFLQEM0PBH8X',
'K2-6g5k3Id0QpvO2mx',
'K3-bCQf3bM4FSJFa21',
'K4-6ObUkvTvnlG5juL',
'K5-rhAIMOfBErAQz4b',
'K6-xoWLRrYsrzVlWKs',
'K7-I6EDv4wAcTw9aTH',
'K8-AFY7sLmUJE6pifR',
'K9-1QMuwhmt8pvEDqo',
'K10-mB7VsjzaPppHlMl',
'K11-af8LgH1e1W6Ob94',
'K12-VbbXh6iQwbCtawz',
'K13-QqFuXiuXukWiJTv',
'K14-ZzrjuuteoKHWdUv',
'K15-4xLnUyK7Rgqi4Aq',
'K16-ayC3MM5TxgbwNLP',
'K17-I7YZFkTdL7APIZ9',
'K18-ENfDID8svgRQpPV',
'K19-tnjRATsbuSvjO6N',
'K20-3lyfWjoL3djvxgP',
'K21-bZ0GbyCJXA46mcT',
'K22-KmL1dlWydfZirDk',
'K23-DwGpCjWVB2vF833',
'K24-ytTVCZGSrL3LpTj',
'K25-ZGgq06MFdMwiKKH',
'K26-KARCn93fugehty8',
'K27-sBt8bYvzKf8b7ef',
'K28-Janp8mw565VddAq',
'K29-mER1wKVpLF4UqSi',
'K30-qRe7Fka01ji1T43',
'K31-e3lqgtbKcvMHuW4',
'K32-mMLmnPx9zDI6dn7',
'K33-d5V0YgTJ5dKd1DK',
'K34-8ZYuu7OMgNjI2v3',
'K35-AHL7nGIdn8oVmFt',
'K36-1DvHfCvq6AzSkOh',
'K37-p7Te5ucdnRbVRxt',
'K38-6g6d4YNRdT3vVj0',
'K39-ghZuQDVjpHVj138',
'K40-cLhc1hF10O0M7l9',
'K41-W8Qttlk0tugQDBk',
'K42-aQdZoq7D9tK0vNi',
'K43-p9s2RRzICZPwuT9',
'K44-r7khKMMDWijP1RG',
'K45-CLLdYEcOYi7Duuo',
'K46-KfhlAW3LDJalKZD',
'K47-V4LypbKXsI9v5q7',
'K48-XA0yQL0L3EQau87',
'K49-RfIsYa6zlhgHI4T',
'K50-FvW62eWzc5csnaW',
'K51-1vPHdDRof9pOK6u',
'K52-Tbfk8H4T4BWqoqc',
'K53-MPTeCDn5or7sWH7',
'K54-RL8tnJzqPtrvsnq',
'K55-Tml8gwXB49yZtjA',
'K56-iaAlcxS7d6vzcNu',
'K57-ZOVE0F1MFJeavpV',
'K58-1EBTTldrxOOaDwk',
'K59-QqngJfcS0wf38Sp',
'K60-5PrgT8qfgCz9rK9',
'K61-QXxWMjLmhWa6u0x',
'K62-qOCsmF7hkaMbF8a',
'K63-zxY6xmuQAstBhs7',
'K64-Z67QvG0myl6Qq6v',
'K65-5Vr6xwra5yvKSfj',
'K66-i2GSqeRUUj346Gj',
'K67-c8oWb0yRVy0DOfO',
'K68-ReiVBk7hRSFSA96',
'K69-3idaQueNFGShMQR',
'K70-C1E8HteRrzgmai2',
'K71-8D4qQ4iYjiJHEBb',
'K72-ABGdsSJiODEg9BJ',
'K73-bzGjPWQQ1GrvoKT',
'K74-YI1Uuth3BeOZ0PS',
'K75-eI9Zv9N9Y3q1TdU',
'K76-AzcOa2GeDJo5EKs',
'K77-IZn8gQ2QePh4Qdj',
'K78-q1v8LQss6kcUHbd',
'K79-KpxqTuQTFAMgzII',
'K80-WGdbPo79UDqSEku',
'K81-WNebFkMcLbqh9gf',
'K82-E0OTfMKoheZgllK',
'K83-V79IpLDZzBE7GnR',
'K84-7mfL7ewEGjFRUhn',
'K85-zVY8lIhfTTKBPBI',
'K86-ze5q0GgP1cO5FHF',
'K87-wxWvyvGXHi7A9In',
'K88-NsPuYaEr3XnhL7U',
'K89-GQSH057ynRNug9X',
'K90-JQurzkXmiiC8tUl',
'K91-AkaSs3E8LFM8Fm7',
'K92-Mq8rylcg3lHJVaJ',
'K93-W8I1eDmmAFVqgfx',
'K94-fuLK2leL6cBptMn',
'K95-Fz4LCqndicDmBpB',
'K96-GgJBTobzPzSnyX7',
'K97-K28FyjX4MeO1dZU',
'K98-yheqrWW1XunLg69',
'K99-RXIAhmuMWkB9DyN',
'K100-3AFB30WvPx6DUwA'
];

const insert = db.prepare('INSERT OR IGNORE INTO keys (key) VALUES (?)');
db.transaction(() => initialKeys.forEach(k => insert.run(k)))();

console.log('âœ… DB initialized and keys inserted:', initialKeys.length);